<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nc-video-easy</title>
    <script src="EasyPlayer-pro.js"></script>
</head>
<style>
    html,
    body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        overflow: hidden;
    }

    #nc_video_easy_player_box,
    #play-btn {
        width: 100%;
        height: 100%;
        background-color: black;
        position: relative;
    }

    #play-btn {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #play-btn svg {
        cursor: pointer;
    }
</style>
<script>
    // 发送信息给父页面
    function sendMessageToParent(messageData) {
        if (window.parent && window.parent !== window) {
            const message = {
                type: 'iframe-message',
                timestamp: new Date().toISOString(),
                url: window.location.href,
                title: document.title,
                ...messageData
            };

            window.parent.postMessage(message, '*');
        } else {
            console.log('No parent window found');
        }
    }
    const params = new URLSearchParams(window.location.search);
    const url = params.get('url');
    const autoplay = params.get('autoplay');
    const muted = params.get('muted');
    let playerInfo = null;
</script>

<body>
    <div id="play-btn" style="display: none;" onclick="manualPlay()">
        <svg t="1730861815254" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="8053" width="40" height="40">
            <path
                d="M780.8 475.733333L285.866667 168.533333c-27.733333-17.066667-64 4.266667-64 36.266667v614.4c0 32 36.266667 53.333333 64 36.266667l492.8-307.2c29.866667-14.933333 29.866667-57.6 2.133333-72.533334z"
                fill="#ffffff" p-id="8054"></path>
        </svg>
    </div>
    <div id="nc_video_easy_player_box"></div>
    <script>
        window.onload = () => {
            let config = {
                isMute: muted === 'true' ? false : true, //是否渲染音频 false 静音 true 不静音
                MSE: true,
                canvasRender: false
            }
            let container = document.getElementById('nc_video_easy_player_box');
            playerInfo = new EasyPlayerPro(container, config);
            playerInfo.on('play', () => {
                sendMessageToParent({ message: 'play' });
            });
            playerInfo.on('pause', () => {
                sendMessageToParent({ message: 'pause' });
            });
            sendMessageToParent({ message: 'loaded' });

            // 监听来自父组件的消息
            window.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'player-command') {
                    const command = event.data.command;
                    const params = event.data.params;
                    if (command === 'destroy') {
                        playerInfo.destroy();
                    } else if (command === 'pause') {
                        playerInfo.pause();
                    } else if (command === 'play') {
                        playerInfo.play(params);
                    } else if (command === 'setMute') {
                        playerInfo.setMute(params);
                    }
                }
            });
            if (autoplay === 'true') {
                playerInfo.play(url);
            } else {
                document.getElementById('play-btn').style.display = 'flex';
            }
        }

        function manualPlay() {
            playerInfo.play(url);
            document.getElementById('play-btn').style.display = 'none';
        }
    </script>
</body>

</html>